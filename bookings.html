<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MMU Campus Events</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="events.css"> </head>
<body>

    <div id="navbar-container"></div>

    <section class="contact-header">
        <h1>My Registered Events</h1>
        <p>Track the status of your event applications.</p>
    </section>

    <section style="max-width: 800px; margin: 40px auto; padding: 20px; min-height: 400px;">
        
        <a href="profile.html" style="color: #3498db; text-decoration: none; font-weight: bold; margin-bottom: 20px; display: inline-block;">&larr; Back to Profile</a>

        <div id="booking-list-container" class="event-list-container" style="max-height: none; padding: 0;">
            <p style="text-align: center; color: gray; margin-top: 50px;">Loading records...</p>
        </div>

    </section>

    <div id="footer-container"></div>

    <script src="layout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userJson = localStorage.getItem('currentUser');
            if (!userJson) {
                alert("Please login to view your bookings.");
                window.location.href = "login.html";
                return;
            }

            const user = JSON.parse(userJson);
            loadBookings(user.id);
        });

        function loadBookings(userId) {
            // Read data from LocalStorage
            const storageKey = `bookings_${userId}`;
            const bookings = JSON.parse(localStorage.getItem(storageKey)) || [];
            const container = document.getElementById('booking-list-container');

            container.innerHTML = '';

            // if no data display No booking found
            if (bookings.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>No bookings found.</h3>
                        <p>You haven't registered for any events yet.</p>
                        <a href="events.html" class="cta-button" style="display: inline-block; margin-top: 20px;">Browse Events</a>
                    </div>
                `;
                return;
            }

            bookings.reverse().forEach((booking, index) => {
    
            let statusColor = '#f39c12';
            let actionButton = '';  

            // Check Status if(Confirmed)
            if (booking.status && booking.status.includes('Confirmed')) {
                statusColor = '#27ae60'; // Green
                actionButton = `
                    <a href="ticket.html?bookingId=${booking.id}" 
                    style="display: inline-block; padding: 8px 15px; background-color: #2c3e50; color: white; text-decoration: none; border-radius: 5px; font-size: 0.85rem;">
                    ðŸŽ« View Ticket
                    </a>`;
    
    } else { //Show paymemt
        actionButton = `
            <a href="payment.html?bookingId=${booking.id}" class="cta-button" 
               style="font-size: 0.8rem; padding: 8px 15px; background-color: #e74c3c; display: inline-block; margin-top: 5px;">
               Pay Now ðŸ’³
            </a>
        `;
    }
    const html = `
        <div class="event-list-item" style="border-left: 5px solid ${statusColor};">
            <div style="flex-grow: 1;">
                <span class="title" style="margin: 0; font-size: 1.1rem;">${booking.title}</span>
                <div style="font-size: 0.85rem; color: #7f8c8d; margin-top: 5px;">
                    Registered on: <strong>${booking.date}</strong>
                </div>
            </div>
            <div style="text-align: right; min-width: 140px;">
                <span style="color: ${statusColor}; font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px;">
                    ${booking.status}
                </span>
                ${actionButton}
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
});
        }
    </script>

</body>
</html>